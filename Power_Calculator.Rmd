---
title: "Power_Calculator"
author: "Nasimeh, Anastasia"
date: "7/5/2022"
output: html_document
---

```{r setup, include=FALSE}
#unzipping 

#import_data = function(zip_file){
#user_path = "/Users/sima/Documents/summer project/datsets/"
#print(user_path)
#unziped_files = unzip(zip_file, exdir = getwd())
#print(unziped_files)
#print(zip_file)
#return(unziped_files)
#}
#user_path = "/Users/sima/Documents/summer project/datsets/"
#temp = list.files(path=getwd(), pattern = "*.zip")
#print(temp)
#a = import_data(temp)
#simulations = apply(temp, import_data)

unzip_file = function(item){
#working_directory = getwd()
temp = list.files(path=getwd(), pattern = paste0("SimMethyl_run_",item))
list_of_txts<-unzip(temp,exdir = getwd()) #,list=TRUE
file1 = read.table(list_of_txts[1])
file2 = read.table(list_of_txts[2])
file3 = read.table(list_of_txts[3], header = TRUE)
workflow = list(file1, file2, file3)
return(workflow)
}
all_runs_output = list()
for (i){
  i=1
  run = unzip_file(i)
  all_runs_output[[i]] = run
}

```

```{r setup, include=FALSE}
#vector
simulated_data = all_runs_output[[1]][[1]]
parameters = all_runs_output[[1]][[3]]
healthy_proportion = parameters$Value[parameters$Parameter == "Healthy proportion"]
n_healthy = ncol(simulated_data)*healthy_proportion
healthy = simulated_data[,1:n_healthy]
diseased = simulated_data[,(n_healthy+1):ncol(simulated_data)]
calculate_means <- function (beta_values_matrix) {
  # check stop if not() to make sure there are no non numeric values.
  means <- rowMeans(beta_values_matrix, na.rm=TRUE)# if all values within a row are NA produces NaN
  means <- na.omit(means) #add handling of NAs if values in the the vector are NAs
  return(means)
}
healthy_mean = calculate_means(healthy)
diseased_mean = calculate_means(diseased)

#groupnames
colnames(simulated_data)[(1:n_healthy)] = "Group1"
colnames(simulated_data)[(n_healthy+1):ncol(simulated_data)] = "Group2"
colnames(simulated_data) = factor(colnames(simulated_data))

```

```{r setup, include=FALSE}
#Tests

t.test(healthy_mean, diseased_mean) #parametric

ks.test(healthy_mean, diseased_mean) #Kolmogorov-Smirnov Tests - non-parametric

```

```{r setup, include=FALSE}
Limma #bayesian based 

# model.matrix(~ simulated_data$Group2) - by manually
Group1 <- ifelse(colnames(simulated_data)=="Group1", 1, 0)
Group2 <- ifelse(colnames(simulated_data)=="Group2", 1, 0)
design_matrix = as.data.frame(cbind(Group1,Group2)) 

contrast_matrix = makeContrasts(Diff = Group2 - Group1, levels = design_matrix)

fit1 <- lmFit(simulated_data, design_matrix)
fit2 <- contrasts.fit(fit1, contrast_matrix)
fit3 <- eBayes(fit2)
bayesian_correction = topTable(fit3)

```

```{r setup, include=FALSE}

BiocManager::install("biocLite")

if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(version = "3.15")
BiocManager::install("limma")
BiocManager::install()


BiocManager::install("biocLite")
library(biocLite)
library(limma)

library(leukemiasEset)
```

```{r setup, include=FALSE}

```

```{r setup, include=FALSE}

```

```{r setup, include=FALSE}

```
